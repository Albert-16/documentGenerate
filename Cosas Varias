using System;
using System.IO;
using HiQPdf.Chromium;

namespace Infrastructure.Helpers.PdfConverters
{
    public class HiqDocxToPdfConverter
    {
        private readonly string _licenseKey;

        public HiqDocxToPdfConverter(string licenseKey)
        {
            if (string.IsNullOrWhiteSpace(licenseKey))
                throw new ArgumentException("La clave de licencia no puede estar vacía.", nameof(licenseKey));

            _licenseKey = licenseKey;
            // Establecer licencia (dependiendo de la versión)
            Licensing.SerialNumber = _licenseKey;  // o License.SetLicenseKey(...), verifica en tu versión
        }

        public void ConvertDocxToPdf(string inputDocxPath, string outputPdfPath)
        {
            if (!File.Exists(inputDocxPath))
                throw new FileNotFoundException("Archivo DOCX no encontrado.", inputDocxPath);

            var converter = new WordToPdfConverter();

            // Opcional: ajustar configuración
            converter.PdfDocumentOptions.UsePageSettingsFromWord = true;
            converter.ProcessPageBreakMarks = true;

            byte[] pdfBytes = converter.ConvertToPdf(inputDocxPath);

            File.WriteAllBytes(outputPdfPath, pdfBytes);
        }

        public byte[] ConvertDocxToPdf(byte[] docxBytes)
        {
            if (docxBytes == null || docxBytes.Length == 0)
                throw new ArgumentException("El contenido DOCX está vacío.", nameof(docxBytes));

            var converter = new WordToPdfConverter();
            converter.PdfDocumentOptions.UsePageSettingsFromWord = true;
            converter.ProcessPageBreakMarks = true;

            return converter.ConvertToPdf(docxBytes);
        }
    }
}
